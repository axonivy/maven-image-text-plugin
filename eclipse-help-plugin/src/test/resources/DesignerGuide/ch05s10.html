<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Intermediate Event</title><link href="css/book.css" type="text/css" rel="stylesheet"><meta content="DocBook XSL Stylesheets V1.78.0" name="generator"><link rel="home" href="index.html" title="Xpert.ivy 5.1"><link rel="up" href="ch05.html" title="Chapter&nbsp;5.&nbsp;Process Elements Reference"><link rel="prev" href="ch05s09.html" title="Task Switch Event"><link rel="next" href="ch05s11.html" title="Call &amp; Wait"><script src="PLUGINS_ROOT/org.eclipse.help/livehelp.js" language="JavaScript"></script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">Intermediate Event </th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ch05s09.html">Prev</a>&nbsp;</td><th align="center" width="60%">Chapter&nbsp;5.&nbsp;Process Elements Reference</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="ch05s11.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ivy.processmodels.elements.intermediate"></a>Intermediate Event </h2></div></div></div>
	
	<p>
                <span class="inlinemediaobject"><img src="images/ProcessElements/intermediate.png"></span> The <span class="emphasis"><em>Intermediate Event</em></span> element
		is located in the <span class="emphasis"><em>Event &amp; Gateway</em></span> drawer of the process editor
		palette.</p>
	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ivy.processmodels.elements.intermediate.element"></a>Element Details</h3></div></div></div>
		
		<p>This element is one of Xpert.ivy facilities to integrate custom-made software, legacy
			systems, proprietary applications or any other external system through an Xpert.ivy Java
			interface. At an Intermediate Event element the process execution is interrupted and
			waits for an external event to occur. Technically spoken the current task will be ended
			and a new system task is created that waits for the intermediate event. If the
			intermediate event is fired the new task and therefore the process after the
			intermediate event will be executed.</p>
		<p>You provide a listener for the external event by implementing a Java class that
			implements the <code class="code">
                        <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/intermediateevent/IProcessIntermediateEventBean.html">IProcessIntermediateEventBean</a>
                    </code> interface. The Intermediate Event
			Element instantiates the Java class and can then trigger the intermediate event by
			calling the method <code class="code">fireProcessIntermediateEventEx</code> on the Xpert.ivy runtime
			engine <code class="code">
                        <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/intermediateevent/IProcessIntermediateEventBeanRuntime.html">IProcessIntermediateEventBeanRuntime</a>
                    </code>. The common way to implement
			an Intermediate Event bean is to extend the abstract base class <code class="code">
                        <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/intermediateevent/AbstractProcessIntermediateEventBean.html">AbstractProcessIntermediateEventBean</a>

                    </code>. The interface also includes
			an inner editor class to parametrize the bean. You will find the documentation of the
			interface and the abstract class in the Java Doc of the Xpert.ivy Public API. </p>
		<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>How Process Intermediate Event Beans work on a Xpert.ivy Cluster Server</b></p></div></div></div>
			
			<p>A Xpert.ivy Cluster Server consists of multiple server instances (nodes) that are
				running on different machines.</p>
			<p>Normally process intermediate event beans are instantiated on every node but only
				started on the master node. This guarantees that for each <span class="italic">Intermediate Event</span> process element only one bean is running, no
				matter what the total number of nodes in the cluster server is.</p>
			<p>However, if you need your intermediate event bean to be started on all cluster
				nodes, you may instruct the server to do so. Just have your bean class implement the
				(empty) marker interface <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/beans/IMultiNodeCapable.html">IMultiNodeCapable</a>

                        </code> and the above restriction will no longer
				apply.</p>
			<p>Please be aware of the fact that having multiple running instances of the same
				bean may lead to race conditions.</p>
		</div>
	</div>
	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ivy.processmodels.elements.intermediate.inscription"></a>Inscription</h3></div></div></div>
		
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N239B6"></a>Name Tab</h4></div></div></div>
			
			<p>This tab is included in the mask of all process elements and contains the name and
				a description of the element. See <a class="link" href="ch05.html#ivy.processmodels.elements.tabs.name" title="Name Tab">Name Tab</a> for a more
				detailed description.</p>
			<div class="mediaobject"><img src="images/ProcessElements/separator.gif"></div>
		</div>
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N239CC"></a>Event Tab</h4></div></div></div>
			
			<p>On this tab you define the Java class that the IntermediateEvent should
				instantiate, the identifier of the event to wait for and the timeout behaviour.</p>
			<div class="mediaobject"><img src="images/ProcessElements/TabIntermediateEvent.png"></div>
			<div class="variablelist"><dl class="variablelist"><dt><span class="term">Java Class to execute</span></dt><dd>
						<p>Fully qualified name of the Java class that implements the <code class="code">
                                    <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/intermediateevent/IProcessIntermediateEventBean.html">IProcessIntermediateEventBean</a>

                                    </code> interface. Use the
								<a class="link" href="ch20s02.html" title="New Bean Class Wizard">New Bean Class
							Wizard</a> (<span class="inlinemediaobject"><img src="images/ProcessElements/ButtonNewBeanClass.png"></span>) to create a new Java source
							file with an example implementation of the bean class. </p>
					</dd><dt><span class="term">Event ID</span></dt><dd>
						<p>Because multiple cases (process instances) can wait on the same
							intermediate event you must specify which event belongs to which waiting
							case. Here you specify the identifier of the event the current case
							should wait for.</p>
						<p>
							</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
								<p>The event identifier as a String must be unique. Do not use a
									static string like <code class="code">"myID"</code>. A good practice is to
									integrate the case identifier
									(<code class="code">ivy.case.getIdentifier()</code>) into the event id.
								</p>
							</div><p>
						</p>
					</dd><dt><span class="term">Timeout</span></dt><dd>
						<p>Here you can specify a time (Duration) how long the current case
							should wait for an intermediate event and what should happen if no event
							has been received after this time. You can optionally start an exception
							process, delete the waiting task or continue the waiting task without
							receiving an intermediate event.</p>
					</dd></dl></div>
			<div class="mediaobject"><img src="images/ProcessElements/separator.gif"></div>
		</div>
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N23A31"></a>Tab Editor</h4></div></div></div>
    
    <p>This tab displays the editor, that can be integrated in the external Java bean of the
        process element. The editor is implemented as an inner public static class of the Java bean
        class and must have the name <code class="code">Editor</code>. Additionally the editor class must
        implement the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IUserProcessExtension.html">IProcessExtensionConfigurationEditorEx</a>
                        </code> interface. The common way to
        implement the editor class is to extend the abstract base class <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/impl/AbstractProcessExtensionConfigurationEditor.html">AbstractProcessExtensionConfigurationEditor</a>
                        </code> and to override the
        methods <code class="code">createEditorPanelContent</code>, <code class="code">loadUiDataFromConfiguration</code> and
            <code class="code">saveUiDataToConfiguration</code>. The method <code class="code">createEditorPanelContent</code>
        can be used to build the UI components of the editor. You can add any AWT/Swing component to
        the given <code class="code">editorPanel</code> parameter. With the given <code class="code">editorEnvironment</code>
        parameter, which is of the type <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IProcessExtensionConfigurationEditorEnvironment.html">IProcessExtensionConfigurationEditorEnvironment</a>
                        </code>, you can create text
        fields that support ivyScript and has smart buttons which provide access to the process
        data, environment functions and Java classes.</p>
    <p>Here is an example of such an editor:</p>
    <p>
                        <span class="inlinemediaobject"><img src="images/ProcessElements/PiEditorSample.png"></span>
                    </p>
    <p>As you can see, the editor provides you access to any process relevant data, which can be
        used by your own process elements. For instance, you can easily transfer process data to
        your legacy system.</p>
    <p>The following part shows the implementation of the editor shown above. As mentioned above
        Xpert.ivy provides the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IIvyScriptEditor.html">IIvyScriptEditor</a>
                        </code> which represents a text field with ivyScript support
        and smart buttons. Inside <code class="code">createEditorPanelContent</code> use the method
            <code class="code">createIvyScriptEditor</code> from the <code class="code">editorEnvironment</code> parameter to
        create an instance of such an editor. Use the <code class="code">loadUiDataFromConfiguration</code>
        method to read the bean configuration and set them to the UI components. Inside this method
        you can use the methods <code class="code">getBeanConfiguration</code> or
            <code class="code">getBeanConfigurationProperty</code> to read the bean configuration. Use the method
            <code class="code">saveUiDataToConfiguration</code> to save the data in the UI components to the bean
        configuration. Inside this method you can use the methods <code class="code">setBeanConfiguration</code>
        or <code class="code">setBeanConfigurationProperty</code> to save the bean configuration.</p>
    <pre class="screen">  public static class Editor extends AbstractProcessExtensionConfigurationEditor
  {
    private IIvyScriptEditor editorUser;
    private IIvyScriptEditor editorEventTyp;
    private IIvyScriptEditor editorLinkId;
    private IIvyScriptEditor editorFieldValue;
    
    @Override
    protected void createEditorPanelContent(Container editorPanel,
            IProcessExtensionConfigurationEditorEnvironment editorEnvironment)
    {
      editorPanel.setLayout(new GridLayout(4,2));
      editorUser = editorEnvironment.createIvyScriptEditor(null,null, "String");
      editorEventTyp = editorEnvironment.createIvyScriptEditor(null,null, "String");
      editorLinkId = editorEnvironment.createIvyScriptEditor(null, null, "String");
      editorFieldValue = editorEnvironment.createIvyScriptEditor(null, null);
      
      editorPanel.add(new JLabel("User"));
      editorPanel.add(editorUser.getComponent());
      editorPanel.add(new JLabel("Event Typ"));
      editorPanel.add(editorEventTyp.getComponent());
      editorPanel.add(new JLabel("Link-Id"));
      editorPanel.add(editorLinkId.getComponent());
      editorPanel.add(new JLabel("Feldwert"));
      editorPanel.add(editorFieldValue.getComponent());        
    }

    @Override
    protected void loadUiDataFromConfiguration()
    {
      editorUser.setText(getBeanConfigurationProperty("User"));
      editorEventTyp.setText(getBeanConfigurationProperty("EventTyp"));
      editorLinkId.setText(getBeanConfigurationProperty("LinkId"));
      editorFieldValue.setText(getBeanConfigurationProperty("Feldwert"));
    }

    @Override
    protected boolean saveUiDataToConfiguration()
    {
      setBeanConfigurationProperty("User", editorUser.getText());
      setBeanConfigurationProperty("EventTyp", editorEventTyp.getText());
      setBeanConfigurationProperty("LinkId", editorLinkId.getText());
      setBeanConfigurationProperty("Feldwert", editorFieldValue.getText());
      return true;
    }
  }    </pre>
    <p>At runtime you have to evaluate the IvyScript the user have entered into the ivy script
        editors. If you implement for example the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/impl/AbstractUserProcessExtension.html">AbstractUserProcessExtension</a>
                        </code> class there is a perform method which is
        executed at runtime. At this point you want to access the configured data in the editor. The
        following code snippet show how you can evaluate the value of an <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IIvyScriptEditor.html">IIvyScriptEditor</a>
                        </code>. If you use the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IIvyScriptEditor.html">IIvyScriptEditor</a>
                        </code> you only get the value by calling the
            <code class="code">executeIvyScript</code> method of the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/impl/AbstractUserProcessExtension.html">AbstractUserProcessExtension</a>
                        </code>.</p>
    <pre class="screen">  public CompositeObject perform(IRequestId requestId, CompositeObject in,
     IIvyScriptContext context) throws Exception
  {
    IIvyScriptContext ownContext;
    CompositeObject out;
    out = in.clone();
    ownContext = createOwnContext(context);

    String eventtyp = "";
    String linkId = "";
    String fieldValue = "";
    String user= "";

    user = (String)executeIvyScript(ownContext, getConfigurationProperty("User"));
    eventtyp = (String)executeIvyScript(ownContext, getConfigurationProperty("Event Typ"));
    linkId = (String)executeIvyScript(ownContext, getConfigurationProperty("Link-Id"));
    fieldValue = (String)executeIvyScript(ownContext, getConfigurationProperty("Feldwert"));
    
    // add your call here
    
    return out;
  }           </pre>
</div>
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N23AC6"></a>Task Tab</h4></div></div></div>
			
			<div class="mediaobject"><img src="images/ProcessElements/TabIntermediateEventTask.png"></div>
			<p>On this tab you configure the parameters of the awaited event which is handled as an
				Intermediate Event Task. Thus it can be displayed in a task list with a filter
				applied to the task kind parameter. The task kind code is the internally used
				identifier to sort and order the processes. The task kind name is a human readable
				description of the code. The Business milestone usually sets the current
					<code class="code">DateTime</code> for process activity analysis and reports.</p>
			<p>You can set the name of the business calendar that should be used for the task. In the
				context of the task <code class="code">ivy.cal</code> will return this business calendar
				regardless of what you've set for the case.</p>
			<p>For more information about business calendar administration see the server guide.</p>
			<p>For more information about business calendar usage see the <a class="link" href="ch07s04.html" title="Public API">Public API</a> of
					<code class="code">ch.ivyteam.ivy.application.calendar.IDefaultBusinessCalendar</code>.</p>
			<div class="mediaobject"><img src="images/ProcessElements/separator.gif"></div>
		</div>
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N23AF7"></a>Output Tab</h4></div></div></div>
			
			<p>On this tab you can configure the output of the element (i.e. the data that leaves
				the element). You can use the variable <code class="code">result</code> that holds additional
				information about the event received by the Java class. </p>
			<p>See <a class="link" href="ch05.html#ivy.processmodels.elements.tabs.output" title="Output Tab">Output Tab</a> for a
				more detailed description.</p>
			<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
				<p>For each incoming connection you have a separate <span class="command"><strong>inX</strong></span> object
					available which carries the data of the Xth input. Hover with the mouse over the
					incoming connections of the element to learn which input connection corresponds
					to which variable.</p>
			</div>
		</div>
	</div>
</div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="ch05s09.html">Prev</a>&nbsp;</td><td align="center" width="20%"><a accesskey="u" href="ch05.html">Up</a></td><td align="right" width="40%">&nbsp;<a accesskey="n" href="ch05s11.html">Next</a></td></tr><tr><td valign="top" align="left" width="40%">Task Switch Event&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;Call &amp; Wait </td></tr></table></div></body></html>