<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>PI (Programming Interface) Step</title><link href="css/book.css" type="text/css" rel="stylesheet"><meta content="DocBook XSL Stylesheets V1.78.0" name="generator"><link rel="home" href="index.html" title="Xpert.ivy 5.1"><link rel="up" href="ch05.html" title="Chapter&nbsp;5.&nbsp;Process Elements Reference"><link rel="prev" href="ch05s22.html" title="Trigger Step"><link rel="next" href="ch05s24.html" title="PUI (Programming User Interface) Step"><script src="PLUGINS_ROOT/org.eclipse.help/livehelp.js" language="JavaScript"></script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">PI (Programming Interface) Step</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ch05s22.html">Prev</a>&nbsp;</td><th align="center" width="60%">Chapter&nbsp;5.&nbsp;Process Elements Reference</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="ch05s24.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ivy.processmodels.elements.pi"></a>PI (Programming Interface) Step</h2></div></div></div>
	
	<p>
                <span class="inlinemediaobject"><img src="images/ProcessElements/pi.png"></span> The <span class="emphasis"><em>Program Interface Step</em></span>
		element is located in the <span class="emphasis"><em>Activity</em></span> drawer of the process editor
		palette.</p>
	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ivy.processmodels.elements.pi.element"></a>Element Details</h3></div></div></div>
		
		<p>This element is one of Xpert.ivy facilities to integrate custom-made software, legacy
			systems, proprietary applications or any other external system through a Java interface.
			The Program Interface element will instantiate a Java class that must implement the
			interface <code class="code">
                        <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IUserProcessExtension.html">IUserProcessExtension</a>
                    </code> and will call the method
			<code class="code">perform</code> each time a process comes to the Program Interface. The common way
			to implement a Program Interface bean is to extend the abstract base class <code class="code">
                        <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/impl/AbstractUserProcessExtension.html">AbstractUserProcessExtension</a>

                    </code>. The interface also includes an
			inner editor class to parametrize the bean. You will find the documentation of the
			interface and the abstract class in the Java Doc of the Xpert.ivy Public API. </p>
		<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
			<p>Since Xpert.ivy 3.x this element has become somewhat obsolete, since it has become
				very easy to create and call your own Java classes from IvyScript. However, the PI
				element still provides a standardized interface to a third party Java class and can
				provide a custom made editor for parametrization.</p>
		</div>
	</div>
	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ivy.processmodels.elements.pi.inscription"></a>Inscription</h3></div></div></div>
		
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N24977"></a>Name Tab</h4></div></div></div>
			
			<p>This tab is included in the mask of all process elements and contains the name and
				a description of the element. See <a class="link" href="ch05.html#ivy.processmodels.elements.tabs.name" title="Name Tab">Name Tab</a> for a more
				detailed description.</p>
			<div class="mediaobject"><img src="images/ProcessElements/separator.gif"></div>
		</div>
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N2498D"></a>Tab PI</h4></div></div></div>
			
			<p>On this tab you set the Java class which implements the interface <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IUserProcessExtension.html">IUserProcessExtension</a>
                        </code> which is called when the PI step is
				executed. Furthermore, you can define exception handlers to react on errors such as
				not reachable systems, insufficient privileges and many more. </p>
			<div class="figure"><a name="N2499C"></a><p class="title"><b>Figure&nbsp;5.20.&nbsp;The PI tab</b></p><div class="figure-contents">
				
				<div class="mediaobject"><img src="images/ProcessElements/TabPI.png" alt="The PI tab"></div>
			</div></div><br class="figure-break">
			<div class="variablelist"><dl class="variablelist"><dt><span class="term">Java Class to Execute</span></dt><dd>
						<p>The fully qualified name of the PI Java class implementing <code class="code">
                                    <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IUserProcessExtension.html">IUserProcessExtension</a>
                                    </code>. You can use default
								<span class="command"><strong>copy &amp; paste</strong></span> commands, open a Java Type
							Browser to search for the class or you use the predefined <code class="code">
                                    <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/beans.Wait.html">Wait</a>

                                    </code> class which just waits for a given period of
							time. Use the <a class="link" href="ch20s02.html" title="New Bean Class Wizard">New Bean Class
								Wizard</a> (<span class="inlinemediaobject"><img src="images/ProcessElements/ButtonNewBeanClass.png"></span>) to create a new Java source
							file with an example implementation of the bean class. </p>
						<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>
							<p>You can add a graphical configuration editor for the Java call
								(i.e. setting the parameter values) on the PI inscription mask. See
								section Tab Editor for more details.</p>
						</div>
					</dd><dt><span class="term">Program Exception / Exception Handler</span></dt><dd>
						<p>The <a class="link" href="ch05s04.html" title="Exception Start">Exception
								step</a> which is executed whenever errors during the call to the
							PI Java class or during the execution of the class are returned.</p>
					</dd><dt><span class="term">Timeout</span></dt><dd>
						<p>Sets a timeout for the return call to the Java PI class. When the
							timeout ends without an answer from the PI class, then the <a class="link" href="ch05s04.html" title="Exception Start">Exception step</a>
							below is executed</p>
					</dd><dt><span class="term">Timeout Exception Handler</span></dt><dd>
						<p>The <a class="link" href="ch05s04.html" title="Exception Start">Exception
								step</a> which is executed whenever the timeout ends without an
							answer from the PI call.</p>
					</dd></dl></div>
			<div class="mediaobject"><img src="images/ProcessElements/separator.gif"></div>
		</div>
		<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N24A18"></a>Tab Editor</h4></div></div></div>
    
    <p>This tab displays the editor, that can be integrated in the external Java bean of the
        process element. The editor is implemented as an inner public static class of the Java bean
        class and must have the name <code class="code">Editor</code>. Additionally the editor class must
        implement the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IUserProcessExtension.html">IProcessExtensionConfigurationEditorEx</a>
                        </code> interface. The common way to
        implement the editor class is to extend the abstract base class <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/impl/AbstractProcessExtensionConfigurationEditor.html">AbstractProcessExtensionConfigurationEditor</a>
                        </code> and to override the
        methods <code class="code">createEditorPanelContent</code>, <code class="code">loadUiDataFromConfiguration</code> and
            <code class="code">saveUiDataToConfiguration</code>. The method <code class="code">createEditorPanelContent</code>
        can be used to build the UI components of the editor. You can add any AWT/Swing component to
        the given <code class="code">editorPanel</code> parameter. With the given <code class="code">editorEnvironment</code>
        parameter, which is of the type <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IProcessExtensionConfigurationEditorEnvironment.html">IProcessExtensionConfigurationEditorEnvironment</a>
                        </code>, you can create text
        fields that support ivyScript and has smart buttons which provide access to the process
        data, environment functions and Java classes.</p>
    <p>Here is an example of such an editor:</p>
    <p>
                        <span class="inlinemediaobject"><img src="images/ProcessElements/PiEditorSample.png"></span>
                    </p>
    <p>As you can see, the editor provides you access to any process relevant data, which can be
        used by your own process elements. For instance, you can easily transfer process data to
        your legacy system.</p>
    <p>The following part shows the implementation of the editor shown above. As mentioned above
        Xpert.ivy provides the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IIvyScriptEditor.html">IIvyScriptEditor</a>
                        </code> which represents a text field with ivyScript support
        and smart buttons. Inside <code class="code">createEditorPanelContent</code> use the method
            <code class="code">createIvyScriptEditor</code> from the <code class="code">editorEnvironment</code> parameter to
        create an instance of such an editor. Use the <code class="code">loadUiDataFromConfiguration</code>
        method to read the bean configuration and set them to the UI components. Inside this method
        you can use the methods <code class="code">getBeanConfiguration</code> or
            <code class="code">getBeanConfigurationProperty</code> to read the bean configuration. Use the method
            <code class="code">saveUiDataToConfiguration</code> to save the data in the UI components to the bean
        configuration. Inside this method you can use the methods <code class="code">setBeanConfiguration</code>
        or <code class="code">setBeanConfigurationProperty</code> to save the bean configuration.</p>
    <pre class="screen">  public static class Editor extends AbstractProcessExtensionConfigurationEditor
  {
    private IIvyScriptEditor editorUser;
    private IIvyScriptEditor editorEventTyp;
    private IIvyScriptEditor editorLinkId;
    private IIvyScriptEditor editorFieldValue;
    
    @Override
    protected void createEditorPanelContent(Container editorPanel,
            IProcessExtensionConfigurationEditorEnvironment editorEnvironment)
    {
      editorPanel.setLayout(new GridLayout(4,2));
      editorUser = editorEnvironment.createIvyScriptEditor(null,null, "String");
      editorEventTyp = editorEnvironment.createIvyScriptEditor(null,null, "String");
      editorLinkId = editorEnvironment.createIvyScriptEditor(null, null, "String");
      editorFieldValue = editorEnvironment.createIvyScriptEditor(null, null);
      
      editorPanel.add(new JLabel("User"));
      editorPanel.add(editorUser.getComponent());
      editorPanel.add(new JLabel("Event Typ"));
      editorPanel.add(editorEventTyp.getComponent());
      editorPanel.add(new JLabel("Link-Id"));
      editorPanel.add(editorLinkId.getComponent());
      editorPanel.add(new JLabel("Feldwert"));
      editorPanel.add(editorFieldValue.getComponent());        
    }

    @Override
    protected void loadUiDataFromConfiguration()
    {
      editorUser.setText(getBeanConfigurationProperty("User"));
      editorEventTyp.setText(getBeanConfigurationProperty("EventTyp"));
      editorLinkId.setText(getBeanConfigurationProperty("LinkId"));
      editorFieldValue.setText(getBeanConfigurationProperty("Feldwert"));
    }

    @Override
    protected boolean saveUiDataToConfiguration()
    {
      setBeanConfigurationProperty("User", editorUser.getText());
      setBeanConfigurationProperty("EventTyp", editorEventTyp.getText());
      setBeanConfigurationProperty("LinkId", editorLinkId.getText());
      setBeanConfigurationProperty("Feldwert", editorFieldValue.getText());
      return true;
    }
  }    </pre>
    <p>At runtime you have to evaluate the IvyScript the user have entered into the ivy script
        editors. If you implement for example the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/impl/AbstractUserProcessExtension.html">AbstractUserProcessExtension</a>
                        </code> class there is a perform method which is
        executed at runtime. At this point you want to access the configured data in the editor. The
        following code snippet show how you can evaluate the value of an <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IIvyScriptEditor.html">IIvyScriptEditor</a>
                        </code>. If you use the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/IIvyScriptEditor.html">IIvyScriptEditor</a>
                        </code> you only get the value by calling the
            <code class="code">executeIvyScript</code> method of the <code class="code">
                            <a class="ulink" href="../PublicAPI/ch/ivyteam/ivy/process/extension/impl/AbstractUserProcessExtension.html">AbstractUserProcessExtension</a>

                        </code>.</p>
    <pre class="screen">  public CompositeObject perform(IRequestId requestId, CompositeObject in,
     IIvyScriptContext context) throws Exception
  {
    IIvyScriptContext ownContext;
    CompositeObject out;
    out = in.clone();
    ownContext = createOwnContext(context);

    String eventtyp = "";
    String linkId = "";
    String fieldValue = "";
    String user= "";

    user = (String)executeIvyScript(ownContext, getConfigurationProperty("User"));
    eventtyp = (String)executeIvyScript(ownContext, getConfigurationProperty("Event Typ"));
    linkId = (String)executeIvyScript(ownContext, getConfigurationProperty("Link-Id"));
    fieldValue = (String)executeIvyScript(ownContext, getConfigurationProperty("Feldwert"));
    
    // add your call here
    
    return out;
  }           </pre>
</div>
	</div>
	<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="N24AAE"></a>Complete Code sample</h3></div></div></div>
		
		<p>
			</p><pre class="screen">public class MyOwnPiBean extends AbstractUserProcessExtension {
				
				/**
				* @see ch.ivyteam.ivy.process.extension.IUserProcessExtension#perform(ch.ivyteam.ivy.process.engine.IRequestId,
				*      ch.ivyteam.ivy.scripting.objects.CompositeObject,
				*      ch.ivyteam.ivy.scripting.language.IIvyScriptContext)
				*/
				public CompositeObject perform(IRequestId requestId, CompositeObject in,
				IIvyScriptContext context) throws Exception {
				
    				IIvyScriptContext ownContext;
    				CompositeObject out;
    				out = in.clone();
    				ownContext = createOwnContext(context);
				
    				String eventtyp = "";
    				String linkId = "";
    				String fieldValue = "";
    				String user= "";
				
    				StringTokenizer st = new StringTokenizer(getConfiguration(),"|");
    				if(st.hasMoreElements())
        				user= (String)executeIvyScript(context, st.nextElement().toString());
    				if(st.hasMoreElements())
        				eventtyp = (String)executeIvyScript(context, st.nextElement().toString());
    				if(st.hasMoreElements())
        				linkId = (String)executeIvyScript(context, st.nextElement().toString());
    				if(st.hasMoreElements())
        				fieldValue = (String)executeIvyScript(context, st.nextElement().toString());
				
    				//do something with the values				
    				return out;
  				}
				
    				public static class Editor extends JPanel implements IProcessExtensionConfigurationEditorEx {
        				private IProcessExtensionConfigurationEditorEnvironment env;
        				private IIvyScriptEditor editorUser;
        				private IIvyScriptEditor editorEventTyp;
        				private IIvyScriptEditor editorLinkId;
        				private IIvyScriptEditor editorFieldValue;
				
				
        				/**
        				* Constructor for the Editor object
        				*/
        				public Editor() {
            				super(new GridLayout(4,2));
        				}
				
        				/**
        				* Sets the configuration
        				* 
        				* @param config  the configuration as an String	*/
    				public void setConfiguration(String config) {
        				StringTokenizer st = new StringTokenizer(config,"|");
        				if(st.hasMoreElements())
            				editorUser.setText(st.nextElement().toString());
        				if(st.hasMoreElements())
            				editorEventTyp.setText(st.nextElement().toString());
        				if(st.hasMoreElements())
            				editorLinkId.setText(st.nextElement().toString());
        				if(st.hasMoreElements())
            				editorFieldValue.setText(st.nextElement().toString());
    				}
				
    				/**
    				* Gets the component attribute of the Editor object
    				* 
    				* @return this
    				*/
    				public Component getComponent() {
        				return this;
    				}
				
    				/**
    				* Gets the configuration
    				* 
    				* @return The configuration as an String
    				*/
    				public String getConfiguration() {
        				return editorUser.getText() + "|" +  editorEventTyp.getText() +  "|" +
        					editorLinkId.getText() + "|" + editorFieldValue.getText() + "|";
    				}
    				
    				/**
    				* @return boolean
    				*/
    				public boolean acceptInput() {
        				return true;
    				}
				
    				public void setEnvironment(IProcessExtensionConfigurationEditorEnvironment env) {
        				this.env = env;
        				editorUser = env.createIvyScriptEditor(null,null, "String");
        				editorEventTyp = env.createIvyScriptEditor(null,null, "String");
        				editorLinkId = env.createIvyScriptEditor(null, null, "String");
        				editorFieldValue = env.createIvyScriptEditor(null, null);
        				
        				add(new JLabel("User"));
        				add(editorUser.getComponent());
        				add(new JLabel("Event Typ"));
        				add(editorEventTyp.getComponent());
        				add(new JLabel("Link-Id"));
        				add(editorLinkId.getComponent());
        				add(new JLabel("Feldwert"));
        				add(editorFieldValue.getComponent());
        				
   				}
  				}
				}
			</pre><p>
		</p>
	</div>
</div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="ch05s22.html">Prev</a>&nbsp;</td><td align="center" width="20%"><a accesskey="u" href="ch05.html">Up</a></td><td align="right" width="40%">&nbsp;<a accesskey="n" href="ch05s24.html">Next</a></td></tr><tr><td valign="top" align="left" width="40%">Trigger Step&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;PUI (Programming User Interface) Step</td></tr></table></div></body></html>