<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>System Events</title><link href="css/book.css" type="text/css" rel="stylesheet"><meta content="DocBook XSL Stylesheets V1.78.0" name="generator"><link rel="home" href="index.html" title="Xpert.ivy 5.1"><link rel="up" href="ch19.html" title="Chapter&nbsp;19.&nbsp;Miscellaneous"><link rel="prev" href="ch19s03.html" title="Eclipse Plugin Mechanism"><link rel="next" href="ch20.html" title="Chapter&nbsp;20.&nbsp;Extensions"><script src="PLUGINS_ROOT/org.eclipse.help/livehelp.js" language="JavaScript"></script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table summary="Navigation header" width="100%"><tr><th align="center" colspan="3">System Events</th></tr><tr><td align="left" width="20%"><a accesskey="p" href="ch19s03.html">Prev</a>&nbsp;</td><th align="center" width="60%">Chapter&nbsp;19.&nbsp;Miscellaneous</th><td align="right" width="20%">&nbsp;<a accesskey="n" href="ch20.html">Next</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ivy.misc.systemevents"></a>System Events</h2></div></div></div>
        
        <p>Xpert.ivy offers the concept of system events, which can be understood as messages
            that are broadcasted across the Xpert.ivy installation. While Xpert.ivy itself (e.g. the
            workflow subsystem) generates events that interested participants may subscribe to (e.g.
            to be informed when a case is created or finished), it is also possible for implementors
            to define their own events and to broadcast them to any component that might be
            interested. Since this mechanism is session- and workflow independent, it can also be
            used to implement <span class="italic">inter-session communication</span> (within
            the same Application). </p>
        <div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ivy.misc.systemevents.framework"></a>Concept and general usage</h3></div></div></div>
            
            <p>System events are messages that are broadcasted across the Xpert.ivy system and
                that will be delivered to any interested party. System events have a name and are
                categorized, and they may carry an optional parameter object. System events can only
                be sent within the same Application on a Xpert.ivy Server. </p>
            <p>Currently two categories are defined: <code class="code">SystemEventCategory.THIRD_PARTY</code>
                and <code class="code">SystemEventCategory.WORKFLOW</code>. The category <code class="code">THIRD_PARTY</code>
                can be used to send (and receive) system events that are generated by integrated
                third party applications (or processes). The category is reserved exclusively for
                this purpose; i.e. the Xpert.ivy server will never generate any events of this type. </p>
            <div class="mediaobject" align="center"><img src="images/Miscellaneous/system_events_concept.png" align="middle"></div>
            <p>The Xpert.ivy system itself currently only generates events of the category
                    <code class="code">WORKFLOW</code>. Inside this category, events with the following names are
                generated:</p>
            <p>

                    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                        <p>
                            <code class="code">WorkflowSystemEvent.TASK_CREATED</code>
                        </p>
                    </li><li class="listitem">
                        <p>
                            <code class="code">WorkflowSystemEvent.TASK_CHANGED</code>
                        </p>
                    </li><li class="listitem">
                        <p>
                            <code class="code">WorkflowSystemEvent.CASE_CREATED</code>
                        </p>
                    </li><li class="listitem">
                        <p>
                            <code class="code">WorkflowSystemEvent.CASE_CHANGED</code>
                        </p>
                    </li></ul></div><p>All of those events carry a parameter object of the type
                    <code class="code">WorkflowSystemEventParameter</code> which gives access to the identifiers
                of the workflow objects that have been created or modified. More system defined
                categories and events can be expected in the future. </p>
            <p>To send system events, client and/or third party applications must first create a
                    <code class="code">SystemEvent</code> object and then get a hold of an
                <code class="code">IApplication</code> object, which offers the method
                    <code class="code">sendSystemEvent(SystemEvent event)</code>. Only events of the category
                    <code class="code">THIRD_PARTY</code> can be sent by process applications, attempts to send
                system events of different categories will result in an error.</p>
            <p>To receive system events, clients must implement the interface
                    <code class="code">ISystemEventListener</code> and must then register themselves on an
                    <code class="code">IApplication</code> object using the method
                    <code class="code">addSystemEventListener(EnumSet&lt;SystemEventCategory&gt; categories,
                    ISystemEventListener listener)</code>. It is strongly recommended, that the
                similar remove method is used, as soon as clients are no longer interested in a
                specific event category. </p>
            <p>Clients should only listen to system events they know the name of, all other
                events should be ignored. Clients should handle received events as fast as possible,
                because handling will block the delivery of events to other receivers. Also the
                received parameter object should never be modified (it shouldn't be modifiable in
                the first place), since this may affect the handling by other receivers which will
                consequently receive a modified event object.</p>
            <p>In Java, the handling of system events generally results in code similar to the
                following: </p>
            <pre class="screen">/** 
 * Registers this participant for workflow system events.
 */ 
 public void registerForWorkflowEvents(IApplication application) 
 { 
    application.addSystemEventListener(EnumSet.of(SystemEventCategory.WORKFLOW));
 }

/** 
 * Unregister this participant for all system events.
 */ 
 public void unregister(IApplication application) 
 { 
    application.removeSystemEventListener(EnumSet.allOf(SystemEventCategory.class));
 }

/** 
 * Implementation of ISystemEventListener.handleSystemEvent(...) 
 * Events will only be delivered for the categories that this listener registered for 
 */ 
 public void handleSystemEvent(SystemEvent event) 
 { 
    String eventName = event.getName(); 
    if ("thirdparty.mysystem.myevent".equals(eventName)) 
    { 
        // do something 
    } 
    else if (WorkflowSystemEvent.TASK_CHANGED.equals(eventName)) 
    { 
        // do something 
    } 
    // else: ignore event 
 } 

 /**
  * Distribute a new system event to all interested/registered listeners of my event.
  * MyEventParameter can be of any (serializable) type, the type is part of the event definition,
  * clients will have to cast accordingly.
  */
 public void sendMyEvent(IApplication application, MyEventParameter param)
 {
    	SystemEvent event = new SystemEvent(SystemEventCategory.THIRD_PARTY, "thirdparty.mysystem.myevent", param);
    application.sendSystemEvent(event);
 }</pre>
            <p>Rich Dialogs can also send and receive <code class="code">SystemEvents</code> via the broadcast
                mechanism. Read the <a class="link" href="ch19s04.html#ivy.misc.systemevents.richdialogs" title="How to send and receive System Events in Rich Dialogs">section
                below</a> to learn how. </p>
            <div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>How System Events work on a Xpert.ivy Cluster Server</b></p></div></div></div>
                
                <p>A Xpert.ivy Cluster Server consists of multiple server instances (nodes) that
                    are running on different machines.</p>
                <p>Distribution of system events is handled in two ways on a cluster server,
                    depending on their category:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
                            <p>
                                    <code class="code">THIRD_PARTY</code> system events are distributed as cluster
                                messages across all nodes, i.e. from the node that generates the
                                event to all other cluster nodes</p>
                        </li><li class="listitem">
                            <p>
                                    <code class="code">WORKFLOW</code> system events are generated on each cluster
                                node in parallel and then distributed locally only</p>
                        </li></ul></div><p>
                        <span class="bold"><strong>Important implementation notes:</strong></span>
                </p>
                <p>Since <code class="code">THIRD_PARTY</code> events are distributed as messages in a
                    Cluster, all custom event parameter objects <span class="italic">must be
                        serializable</span>.</p>
                <p>Please be aware of the fact that having multiple running instances of a system
                    event sender may lead to race conditions. If you use system events for message
                    exchange between e.g. processes and/or User Dialogs and third party systems that
                    are integrated via the Server Extension mechanism, you should ensure that a
                    certain event is only sent once. This may require that the third party system
                    (e.g. an ESB) is only started on one node in the cluster. Otherwise a received
                    message from the external system may be injected into the Xpert.ivy Cluster
                    system n times (once for each node) instead of being sent only once.</p>
            </div>
        </div>
        <div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="ivy.misc.systemevents.richdialogs"></a>How to send and receive System Events in Rich Dialogs</h3></div></div></div>
            
            <p>By using the event broadcast mechanism in combination with the <a class="link" href="ch19s04.html#ivy.misc.systemevents.framework" title="Concept and general usage">System Events framework</a>, Rich
                Dialogs can receive and send system events as broadcast events. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
                    <p>Check out the <span class="italic">Chat Demo</span> in the
                            <em class="filename">IvyDemos</em> project (available from your Xpert.ivy
                        Designer installation directory under
                            <em class="filename">applications/samples/IvyDemos</em>) to see how System
                        Events can be used to implement an inter-session information exchange. </p>
                    <p>The demo implements a simple chat application which makes usage of
                            <code class="code">THIRD_PARTY</code> system events to send or receive messages from
                        chat users, respectively.</p>
                </div><p>

                </p>
            <div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N2D770"></a>Receiving System Events</h4></div></div></div>
                
                <p>Before the Rich Dialog can receive any events, it must register itself for the
                    respective categories. This is done by calling
                        <code class="code">ivy.rd.subscribeToSystemEvent(SystemEventCategory)</code>. Typically
                    this registration should happen in the start method process of the Rich Dialog
                    as shown below. Explicit de-registration is not necessary, all Rich Dialogs will
                    automatically be unregistered as soon as their panel is unloaded (i.e. when the
                    Rich Dialog executes a Rich Dialog End element).</p>
                <p>Furthermore, the Rich Dialog must declare all the names of the system events
                    it is interested in as accepted broadcast events on it's interface. The category
                    of the system event does not matter (they are defined in the registration call
                    as described above). However, the name of the accepted broadcast event must be
                    exactly identical to the name of the system events that the rich dialog is
                    interested in. Also the type of the parameter must be identical to the type of
                    the system event's optional parameter. If names or parameter type do not match,
                    then the system event will not be delivered.</p>
                <p>The handling of the declared accepted broadcast events is then implemented
                    with Rich Dialog event handler processes as usual.</p>
                <div class="mediaobject" align="center"><img src="images/Miscellaneous/system_events_rd_usage.png" align="middle"></div>
                <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
                    <p>Due to technical reasons, the name of an accepted broadcast event has to
                        be a valid <span class="italic">Java</span> identifier. Therefore the
                        original name of a system event may be an illegal name for an accepted
                        broadcast event (e.g. the system event name <span class="italic">foo.bar.baz</span> will not be accepted because it contains
                        punctuation). In such cases the name of the accepted broadcast event should
                        substitute all illegal characters with underscores, e.g. <span class="italic">foo_bar_baz</span> for the given example) </p>
                </div>
            </div>
            <div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="N2D79E"></a>Sending System Events</h4></div></div></div>
                
                <p>Sending System Events from a Rich Dialog is fairly easy. There are two possibilities:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
                            <p>On the Rich Dialog interface <a class="link" href="ch09s03.html#ivy.editors.richdialoginterface.firedevents" title="Fired Events">declare a
                                    fired event</a> with scope <code class="code">SYSTEM</code>. Then use the
                                    <a class="link" href="ch05s32.html" title="User Dialog Fire Event Step">Fire
                                    Event process element</a> to send the event. The category of
                                the system event will always be <code class="code">THIRD_PARTY</code>, the
                                declared event's name will be used as the system event's name and
                                the (optional) parameter will become the system event's parameter. </p><div class="mediaobject" align="center"><img src="images/Miscellaneous/system_events_rd_fire.png" align="middle"></div><p>

                                </p>
                        </li><li class="listitem">
                            <p>Use IvyScript/Java to send a system event through the
                                    <code class="code">IApplication.sendSystemEvent(SystemEvent)</code> API as
                                described in the general usage <a class="link" href="ch19s04.html#ivy.misc.systemevents.framework" title="Concept and general usage">section above</a>.
                            </p>
                        </li></ol></div><p>

                    </p>
            </div>
        </div>
    </div><div class="navfooter"><hr><table summary="Navigation footer" width="100%"><tr><td align="left" width="40%"><a accesskey="p" href="ch19s03.html">Prev</a>&nbsp;</td><td align="center" width="20%"><a accesskey="u" href="ch19.html">Up</a></td><td align="right" width="40%">&nbsp;<a accesskey="n" href="ch20.html">Next</a></td></tr><tr><td valign="top" align="left" width="40%">Eclipse Plugin Mechanism&nbsp;</td><td align="center" width="20%"><a accesskey="h" href="index.html">Home</a></td><td valign="top" align="right" width="40%">&nbsp;Chapter&nbsp;20.&nbsp;Extensions</td></tr></table></div></body></html>